#  простой сервер на сокетах, который принимает одно соединение от клиента, получает и отправляет текстовые сообщения в бесконечном цикле до тех пор, пока клиент не отключится
import socket  # Импортируем модуль socket для работы с сетевыми соединениями

# Получаем имя текущего хоста (машины), чтобы привязать к нему сервер
host_name = socket.gethostname()
# Указываем порт, на котором будет работать сервер
port = 5000

# Создаем сокет с использованием IPv4 и TCP
s_socket = socket.socket(socket.AF_INET, socket.SOCK_STREAM)
# Привязываем сокет к указанному хосту и порту
s_socket.bind((host_name, port))
# Запускаем прослушивание входящих соединений; 2 — максимальное количество очереди
s_socket.listen(2)
# Выводим сообщение о том, что сервер запущен
print("Server listening on {}:{}".format(host_name, port))
# Принимаем входящее соединение; блокирует выполнение до подключения клиента
conn, address = s_socket.accept()
# Выводим адрес подключившегося клиента
print("Connection from: {}".format(str(address)))
# Начинаем бесконечный цикл общения с клиентом
while True:
    # Получаем данные от клиента (максимум 1024 байта), декодируем в строку
    recv_data = conn.recv(1024).decode()
    # Если данных нет (например, клиент отключился)
    if not recv_data:
        break  # Выход из цикла
    # Печатаем полученное сообщение от клиента
    print("From connected user: {}".format(str(recv_data)))
    # Ждем ввода сообщения от пользователя сервера
    send_data = input("-->")
    # Отправляем сообщение клиенту, предварительно закодировав его
    conn.send(send_data.encode())

conn.close()  # Закрываем соединение с клиентом после завершения общения
